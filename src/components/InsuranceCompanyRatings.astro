---
// Insurance Company Rating System Component - Using Authentic, Verifiable Data
// Data Sources: A.M. Best, NAIC, J.D. Power, Company Annual Reports
// Last Updated: September 2025

const companies = [
  {
    name: "State Farm",
    logo: "/images/logos/state-farm.png",
    financialStrength: "A++", // A.M. Best Rating - Verified
    coverage: ["Auto", "Home", "Life", "Health"],
    generalFeatures: [
      "Largest U.S. auto insurer by market share",
      "Extensive agent network nationwide", 
      "Multiple coverage options available"
    ],
    considerations: [
      "Rates vary significantly by location",
      "Agent-focused service model",
      "Limited online self-service options"
    ],
    premiumRange: {
      auto: "Varies by state and driver profile",
      home: "Competitive in most markets",
      life: "Multiple product options available"
    },
    phone: "1-800-STATE-FARM",
    website: "statefarm.com",
    established: "1922", // Verified historical fact
    marketPosition: "Market Leader"
  },
  {
    name: "GEICO",
    logo: "/images/logos/geico.png", 
    financialStrength: "A++", // A.M. Best Rating - Verified
    coverage: ["Auto", "Home", "Motorcycle", "Renters"],
    generalFeatures: [
      "Direct-to-consumer sales model",
      "Award-winning mobile app",
      "24/7 customer service availability"
    ],
    considerations: [
      "Limited local agent presence",
      "Primarily focused on auto insurance",
      "Home insurance through partnerships"
    ],
    premiumRange: {
      auto: "Often competitive for good drivers",
      home: "Available through partner companies",
      motorcycle: "Specialized coverage available"
    },
    phone: "1-800-GEICO",
    website: "geico.com", 
    established: "1936", // Verified historical fact
    marketPosition: "Major Player"
  },
  {
    name: "Progressive",
    logo: "/images/logos/progressive.png",
    financialStrength: "A+", // A.M. Best Rating - Verified
    coverage: ["Auto", "Home", "Commercial", "Motorcycle"],
    generalFeatures: [
      "Name Your Price comparison tool",
      "Snapshot usage-based insurance program",
      "Online quote and comparison platform"
    ],
    considerations: [
      "Service quality can vary by region",
      "Some coverage limitations apply",
      "Home insurance through partnerships"
    ],
    premiumRange: {
      auto: "Competitive rates for many drivers",
      home: "Available in most states",
      commercial: "Small business focus"
    },
    phone: "1-800-PROGRESSIVE",
    website: "progressive.com",
    established: "1937", // Verified historical fact
    marketPosition: "Innovation Leader"
  },
  {
    name: "Allstate",
    logo: "/images/logos/allstate.png",
    financialStrength: "A+", // A.M. Best Rating - Verified  
    coverage: ["Auto", "Home", "Life", "Renters"],
    generalFeatures: [
      "Bundling discounts available",
      "Accident forgiveness programs",
      "Local agent network"
    ],
    considerations: [
      "Premium costs vary significantly",
      "Complex pricing structure",
      "Agent-dependent service experience"
    ],
    premiumRange: {
      auto: "Mid-range to premium pricing",
      home: "Full coverage options",
      renters: "Comprehensive renter policies"
    },
    phone: "1-800-ALLSTATE",
    website: "allstate.com",
    established: "1931", // Verified historical fact
    marketPosition: "Established Leader"
  },
  {
    name: "USAA",
    logo: "/images/logos/usaa.png",
    financialStrength: "A++", // A.M. Best Rating - Verified
    coverage: ["Auto", "Home", "Life", "Banking"],
    generalFeatures: [
      "Military-focused service model",
      "Comprehensive financial services",
      "High customer satisfaction ratings"
    ],
    considerations: [
      "Membership restricted to military families",
      "Limited physical locations",
      "Eligibility verification required"
    ],
    premiumRange: {
      auto: "Competitive for eligible members",
      home: "Military-friendly pricing",
      life: "Specialized military coverage"
    },
    phone: "1-800-USAA",
    website: "usaa.com",
    established: "1922", // Verified historical fact
    eligibility: "Military families and veterans only",
    marketPosition: "Niche Leader"
  },
  {
    name: "Farmers Insurance",
    logo: "/images/logos/farmers.png",
    financialStrength: "A", // A.M. Best Rating - Verified
    coverage: ["Auto", "Home", "Life", "Business"],
    generalFeatures: [
      "Flexible policy customization",
      "Local agent support model",
      "Business insurance specialization"
    ],
    considerations: [
      "Premium costs can be higher",
      "Limited digital service options",
      "Agent quality varies by location"
    ],
    premiumRange: {
      auto: "Premium pricing tier",
      home: "Comprehensive coverage options",
      business: "Small to medium business focus"
    },
    phone: "1-800-FARMERS",
    website: "farmers.com",
    established: "1928", // Verified historical fact
    marketPosition: "Regional Focus"
  }
];

const { sortBy = 'overall', filterBy = 'all' } = Astro.props;
---

<div class="bg-white dark:bg-gray-900 rounded-xl border shadow-lg p-6">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
    <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4 md:mb-0">
      Insurance Company Ratings
    </h2>
    
    <div class="flex flex-col sm:flex-row gap-3">
      <select id="sort-companies" class="px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
        <option value="name">Sort by Company Name</option>
        <option value="financial">Sort by Financial Strength</option>
        <option value="established">Sort by Year Established</option>
        <option value="market">Sort by Market Position</option>
      </select>
      
      <select id="filter-coverage" class="px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
        <option value="all">All Coverage Types</option>
        <option value="auto">Auto Insurance</option>
        <option value="home">Home Insurance</option>
        <option value="life">Life Insurance</option>
      </select>
    </div>
  </div>

  <div id="companies-grid" class="space-y-6">
    {companies.map((company, index) => (
      <div class="company-card border border-gray-200 dark:border-gray-700 rounded-lg p-6 hover:shadow-md transition-shadow min-h-[280px] flex flex-col" data-company={company.name.toLowerCase().replace(/\s+/g, '-')}>
        <div class="grid md:grid-cols-4 gap-6 h-full">
          <!-- Company Info -->
          <div class="md:col-span-1 flex flex-col">
            <div class="flex items-center mb-3">
              <div class="w-12 h-12 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center mr-3">
                <span class="text-lg font-bold text-gray-600 dark:text-gray-300">
                  {company.name.charAt(0)}
                </span>
              </div>
              <div>
                <h3 class="font-bold text-lg text-gray-900 dark:text-white">{company.name}</h3>
                <div class="text-xs text-gray-500">Est. {company.established}</div>
              </div>
            </div>
            
            {company.eligibility && (
              <div class="text-xs bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200 px-2 py-1 rounded mb-2">
                {company.eligibility}
              </div>
            )}
            
            <div class="flex flex-wrap gap-1 mb-3 flex-grow">
              {company.coverage.map((type) => (
                <span class="text-xs bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 px-2 py-1 rounded">
                  {type}
                </span>
              ))}
            </div>
          </div>

          <!-- Company Details -->
          <div class="md:col-span-1 flex flex-col">
            <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Company Info</h4>
            <div class="space-y-2 text-sm flex-grow">
              <div class="flex justify-between">
                <span>Financial Strength</span>
                <span class="font-bold text-blue-600">{company.financialStrength}</span>
              </div>
              <div class="flex justify-between">
                <span>Market Position</span>
                <span class="font-medium text-gray-700 dark:text-gray-300">{company.marketPosition}</span>
              </div>
              <div class="flex justify-between">
                <span>Founded</span>
                <span class="text-gray-600 dark:text-gray-400">{company.established}</span>
              </div>
            </div>
          </div>

          <!-- Features & Considerations -->
          <div class="md:col-span-1 flex flex-col">
            <div class="mb-4 flex-grow">
              <h4 class="font-semibold text-green-700 dark:text-green-400 mb-2 text-sm">Key Features</h4>
              <ul class="text-xs space-y-1">
                {company.generalFeatures.slice(0, 3).map((feature) => (
                  <li class="flex items-start">
                    <span class="text-green-500 mr-1">✓</span>
                    <span>{feature}</span>
                  </li>
                ))}
              </ul>
            </div>
            <div>
              <h4 class="font-semibold text-orange-700 dark:text-orange-400 mb-2 text-sm">Considerations</h4>
              <ul class="text-xs space-y-1">
                {company.considerations.slice(0, 2).map((consideration) => (
                  <li class="flex items-start">
                    <span class="text-orange-500 mr-1">•</span>
                    <span>{consideration}</span>
                  </li>
                ))}
              </ul>
            </div>
          </div>

          <!-- Contact & Pricing -->
          <div class="md:col-span-1 flex flex-col">
            <h4 class="font-semibold text-gray-900 dark:text-white mb-2 text-sm">Premium Information</h4>
            <div class="text-xs space-y-1 mb-4 flex-grow">
              {company.premiumRange.auto && (
                <div class="mb-2">
                  <span class="font-medium">Auto:</span>
                  <div class="text-gray-600 dark:text-gray-400">{company.premiumRange.auto}</div>
                </div>
              )}
              {company.premiumRange.home && (
                <div class="mb-2">
                  <span class="font-medium">Home:</span>
                  <div class="text-gray-600 dark:text-gray-400">{company.premiumRange.home}</div>
                </div>
              )}
              {company.premiumRange.life && (
                <div class="mb-2">
                  <span class="font-medium">Life:</span>
                  <div class="text-gray-600 dark:text-gray-400">{company.premiumRange.life}</div>
                </div>
              )}
            </div>
            
            <div class="space-y-2 mt-auto">
              <a href={`https://${company.website}`} class="block text-xs text-blue-600 hover:text-blue-700 font-medium" target="_blank" rel="noopener">
                Visit {company.website} →
              </a>
              <div class="text-xs text-gray-500">{company.phone}</div>
            </div>
          </div>
        </div>
      </div>
    ))}
  </div>

  <!-- Data Sources & Disclaimer -->
  <div class="mt-8 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg">
    <div class="mb-3">
      <h4 class="text-sm font-semibold text-gray-900 dark:text-white mb-2">Data Sources</h4>
      <p class="text-xs text-gray-600 dark:text-gray-400 mb-2">
        • Financial Strength Ratings: A.M. Best Company<br>
        • Company Information: Publicly available annual reports and SEC filings<br>
        • Historical Data: Company websites and verified public records<br>
        • Market Position: Industry publications and regulatory filings
      </p>
    </div>
    
    <p class="text-xs text-gray-600 dark:text-gray-400">
      <strong>Important Disclaimer:</strong> This information is provided for general informational and educational purposes only. 
      Company features, offerings, and market positions are subject to change. Premium costs vary significantly based on individual factors including location, age, driving record, credit score, coverage levels, and other underwriting criteria. 
      Financial strength ratings are current as of publication but may change. No specific performance claims or rate guarantees are made. 
      Individual experiences with insurance companies may vary significantly from general market information. 
      Always obtain personalized quotes and verify current information directly with insurance companies or licensed agents before making coverage decisions.
      <br><br>
      <strong>Last Updated:</strong> September 2025 | <strong>Next Review:</strong> Quarterly
    </p>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const sortSelect = document.getElementById('sort-companies');
  const filterSelect = document.getElementById('filter-coverage');
  const companiesGrid = document.getElementById('companies-grid');
  
  let companiesData = companies.map(c => ({...c, name: c.name}));

  function sortAndFilter() {
    const sortBy = sortSelect.value;
    const filterBy = filterSelect.value;
    
    let filtered = companiesData;
    
    // Apply filter
    if (filterBy !== 'all') {
      filtered = companiesData.filter(company => 
        company.coverage.some(coverage => coverage.toLowerCase() === filterBy)
      );
    }
    
    // Apply sort
    filtered.sort((a, b) => {
      switch(sortBy) {
        case 'financial':
          // Financial strength comparison (A++ > A+ > A)
          const strengthOrder = {'A++': 3, 'A+': 2, 'A': 1, 'B++': 0, 'B+': -1, 'B': -2};
          return (strengthOrder[b.financialStrength] || 0) - (strengthOrder[a.financialStrength] || 0);
        case 'established':
          // Sort by establishment year (oldest first)
          const aYear = parseInt(a.established) || 0;
          const bYear = parseInt(b.established) || 0;
          return aYear - bYear;
        case 'market':
          // Sort by market position
          const marketOrder = {
            'Market Leader': 5,
            'Major Player': 4,
            'Innovation Leader': 4,
            'Established Leader': 3,
            'Niche Leader': 2,
            'Regional Focus': 1
          };
          return (marketOrder[b.marketPosition] || 0) - (marketOrder[a.marketPosition] || 0);
        default: // name
          return a.name.localeCompare(b.name);
      }
    });
    
    // Re-render cards in new order
    const cards = Array.from(companiesGrid.children);
    cards.forEach(card => card.remove());
    
    filtered.forEach(company => {
      const cardSelector = `[data-company="${company.name.toLowerCase().replace(/\\s+/g, '-')}"]`;
      const card = companiesGrid.querySelector(cardSelector) || 
                   cards.find(c => c.dataset.company === company.name.toLowerCase().replace(/\\s+/g, '-'));
      if (card) {
        companiesGrid.appendChild(card);
      }
    });
  }

  sortSelect.addEventListener('change', sortAndFilter);
  filterSelect.addEventListener('change', sortAndFilter);
});
</script>

<style>
  .company-card {
    transition: all 0.2s ease;
  }
  
  .company-card:hover {
    transform: translateY(-2px);
  }
  
  @media (max-width: 768px) {
    .company-card {
      padding: 1rem;
    }
  }
</style>