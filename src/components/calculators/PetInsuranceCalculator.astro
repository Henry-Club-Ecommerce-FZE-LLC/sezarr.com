---
---

<div class="bg-white dark:bg-gray-900 rounded-xl shadow-lg p-8 border border-gray-200 dark:border-gray-700">
  <div class="mb-8">
    <h2 class="text-2xl lg:text-3xl font-bold text-gray-900 dark:text-white mb-4">
      Pet Insurance Calculator
    </h2>
    <p class="text-gray-600 dark:text-gray-300">
      Estimate your pet insurance costs based on your pet's details and coverage preferences.
    </p>
  </div>

  <form id="petInsuranceForm" class="space-y-6">
    <!-- Pet Information -->
    <div class="grid md:grid-cols-2 gap-6">
      <div>
        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
          Pet Type
        </label>
        <select id="petType" name="petType" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent">
          <option value="dog">Dog</option>
          <option value="cat">Cat</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
          Pet Age
        </label>
        <select id="petAge" name="petAge" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent">
          <option value="puppy">Puppy/Kitten (0-1 year)</option>
          <option value="young">Young Adult (1-3 years)</option>
          <option value="adult">Adult (3-7 years)</option>
          <option value="senior">Senior (7+ years)</option>
        </select>
      </div>
    </div>

    <div class="grid md:grid-cols-2 gap-6">
      <div>
        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
          Breed Category
        </label>
        <select id="breedCategory" name="breedCategory" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent">
          <option value="mixed">Mixed Breed</option>
          <option value="small">Small Purebred</option>
          <option value="medium">Medium Purebred</option>
          <option value="large">Large Purebred</option>
          <option value="giant">Giant Breed</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
          Location
        </label>
        <select id="location" name="location" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent">
          <option value="rural">Rural Area</option>
          <option value="suburban">Suburban</option>
          <option value="urban">Urban Area</option>
          <option value="metro">Major Metro</option>
        </select>
      </div>
    </div>

    <!-- Coverage Options -->
    <div>
      <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
        Coverage Type
      </label>
      <div class="grid md:grid-cols-2 gap-4">
        <label class="flex items-center p-4 border border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800">
          <input type="radio" name="coverageType" value="accident" class="text-purple-600 focus:ring-purple-500">
          <div class="ml-3">
            <div class="font-medium text-gray-900 dark:text-white">Accident Only</div>
            <div class="text-sm text-gray-600 dark:text-gray-300">Basic protection for injuries</div>
          </div>
        </label>
        <label class="flex items-center p-4 border border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800">
          <input type="radio" name="coverageType" value="comprehensive" checked class="text-purple-600 focus:ring-purple-500">
          <div class="ml-3">
            <div class="font-medium text-gray-900 dark:text-white">Accident & Illness</div>
            <div class="text-sm text-gray-600 dark:text-gray-300">Complete medical coverage</div>
          </div>
        </label>
      </div>
    </div>

    <div class="grid md:grid-cols-2 gap-6">
      <div>
        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
          Deductible
        </label>
        <select id="deductible" name="deductible" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent">
          <option value="100">$100 (Higher Premium)</option>
          <option value="250" selected>$250 (Balanced)</option>
          <option value="500">$500 (Lower Premium)</option>
          <option value="1000">$1,000 (Lowest Premium)</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">
          Reimbursement Rate
        </label>
        <select id="reimbursementRate" name="reimbursementRate" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent">
          <option value="70">70% (Lower Cost)</option>
          <option value="80" selected>80% (Popular Choice)</option>
          <option value="90">90% (Higher Cost)</option>
        </select>
      </div>
    </div>

    <!-- Add-ons -->
    <div>
      <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-4">
        Additional Coverage (Optional)
      </label>
      <div class="space-y-3">
        <label class="flex items-center">
          <input type="checkbox" id="wellness" name="addons" value="wellness" class="text-purple-600 focus:ring-purple-500">
          <span class="ml-3 text-gray-700 dark:text-gray-300">Wellness & Routine Care (+$15-25/month)</span>
        </label>
        <label class="flex items-center">
          <input type="checkbox" id="dental" name="addons" value="dental" class="text-purple-600 focus:ring-purple-500">
          <span class="ml-3 text-gray-700 dark:text-gray-300">Dental Coverage (+$10-15/month)</span>
        </label>
        <label class="flex items-center">
          <input type="checkbox" id="alternative" name="addons" value="alternative" class="text-purple-600 focus:ring-purple-500">
          <span class="ml-3 text-gray-700 dark:text-gray-300">Alternative Therapies (+$5-10/month)</span>
        </label>
      </div>
    </div>

    <button 
      type="submit" 
      class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold py-4 px-8 rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all duration-300 shadow-lg hover:shadow-xl"
    >
      Calculate Pet Insurance Cost
    </button>
  </form>

  <!-- Results Section -->
  <div id="results" class="hidden mt-8 p-6 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-xl border border-purple-200 dark:border-purple-700">
    <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-4">Your Estimated Costs</h3>
    
    <div class="grid md:grid-cols-3 gap-6 mb-6">
      <div class="text-center">
        <div class="text-2xl font-bold text-purple-600 dark:text-purple-400" id="monthlyPremium">$0</div>
        <div class="text-sm text-gray-600 dark:text-gray-300">Monthly Premium</div>
      </div>
      <div class="text-center">
        <div class="text-2xl font-bold text-pink-600 dark:text-pink-400" id="annualCost">$0</div>
        <div class="text-sm text-gray-600 dark:text-gray-300">Annual Cost</div>
      </div>
      <div class="text-center">
        <div class="text-2xl font-bold text-green-600 dark:text-green-400" id="lifetimeSavings">$0</div>
        <div class="text-sm text-gray-600 dark:text-gray-300">Potential Lifetime Savings</div>
      </div>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-lg p-4">
      <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Coverage Summary</h4>
      <div id="coverageSummary" class="space-y-2 text-sm text-gray-600 dark:text-gray-300">
        <!-- Dynamic content will be inserted here -->
      </div>
    </div>

    <div class="mt-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-lg">
      <h4 class="font-semibold text-yellow-800 dark:text-yellow-200 mb-2">
        💡 Money-Saving Tips
      </h4>
      <ul class="text-sm text-yellow-700 dark:text-yellow-300 space-y-1" id="savingsTips">
        <!-- Dynamic tips will be inserted here -->
      </ul>
    </div>
  </div>

  <!-- Disclaimer -->
  <div class="mt-8 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700">
    <p class="text-xs text-gray-600 dark:text-gray-400">
      <strong>Disclaimer:</strong> This calculator provides estimates based on industry averages and typical pricing. Actual costs may vary significantly based on your specific pet, location, chosen provider, and policy terms. This tool is for informational purposes only and does not constitute professional advice. Always obtain personalized quotes from insurance providers for accurate pricing.
    </p>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('petInsuranceForm');
    const results = document.getElementById('results');

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      calculatePetInsurance();
    });

    async function calculatePetInsurance() {
      // Get form values
      const petType = document.getElementById('petType').value;
      const petAge = document.getElementById('petAge').value;
      const breedCategory = document.getElementById('breedCategory').value;
      const location = document.getElementById('location').value;
      const coverageType = document.querySelector('input[name="coverageType"]:checked').value;
      const deductible = parseInt(document.getElementById('deductible').value);
      const reimbursementRate = parseInt(document.getElementById('reimbursementRate').value);
      const addons = Array.from(document.querySelectorAll('input[name="addons"]:checked')).map(function(cb) { return cb.value; });

      // Show loading state
      results.innerHTML = '<div class="text-center py-8"><div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div><p class="mt-2">Calculating pet insurance rates...</p></div>';
      results.classList.remove('hidden');

      try {
        // Map age to numeric value for API
        const ageMapping = {
          'puppy': 0.5,
          'young': 2,
          'adult': 6,
          'senior': 10
        };
        const numericAge = ageMapping[petAge] || 2;

        // Get live rates if available
        if (window.ClientRateFetcher) {
          const rates = await window.ClientRateFetcher.getPetRates('CA', {
            petType: petType,
            petAge: numericAge,
            breed: breedCategory,
            deductible: deductible,
            reimbursement: reimbursementRate,
            zipCode: '90210'
          });

          displayEnhancedPetResults(rates, {
            petType: petType,
            petAge: petAge,
            breedCategory: breedCategory,
            coverageType: coverageType,
            deductible: deductible,
            reimbursementRate: reimbursementRate,
            addons: addons
          });
        } else {
          // Fall back to original calculation
          fallbackPetCalculation();
        }
      } catch (error) {
        console.error('Pet insurance rate calculation error:', error);
        fallbackPetCalculation();
      }

      function fallbackPetCalculation() {
        // Original calculation logic as fallback
        let basePremium = 0;

        // Pet type factor
        if (petType === 'dog') {
          basePremium = 35;
        } else {
          basePremium = 25;
        }

        // Age factor
        const ageMultipliers = {
          'puppy': 0.8,
          'young': 1.0,
          'adult': 1.3,
          'senior': 1.8
        };
        basePremium *= ageMultipliers[petAge];

        // Breed factor
        const breedMultipliers = {
          'mixed': 0.9,
          'small': 1.0,
          'medium': 1.1,
          'large': 1.2,
          'giant': 1.4
        };
        basePremium *= breedMultipliers[breedCategory];

        // Location factor
        const locationMultipliers = {
          'rural': 0.8,
          'suburban': 1.0,
          'urban': 1.2,
          'metro': 1.4
        };
        basePremium *= locationMultipliers[location];

        // Coverage type factor
        if (coverageType === 'accident') {
          basePremium *= 0.4;
        } else if (coverageType === 'illness') {
          basePremium *= 0.7;
        }

        // Deductible factor
        if (deductible >= 1000) {
          basePremium *= 0.8;
        } else if (deductible >= 500) {
          basePremium *= 0.9;
        } else if (deductible === 100) {
          basePremium *= 1.2;
        }

        // Reimbursement factor
        if (reimbursementRate >= 90) {
          basePremium *= 1.2;
        } else if (reimbursementRate >= 80) {
          basePremium *= 1.1;
        } else if (reimbursementRate <= 70) {
          basePremium *= 0.9;
        }

        // Add-ons
        let addonCost = 0;
        addons.forEach(function(addon) {
          if (addon === 'wellness') addonCost += 15;
          if (addon === 'dental') addonCost += 8;
          if (addon === 'prescriptionDrugs') addonCost += 5;
        });

        const monthlyPremium = Math.round(basePremium + addonCost);
        const annualCost = monthlyPremium * 12;
        const lifetimeSavings = calculateLifetimeSavings(petType, coverageType, monthlyPremium);

        // Update display
        document.getElementById('monthlyPremium').textContent = '$' + monthlyPremium;
        document.getElementById('annualCost').textContent = '$' + annualCost.toLocaleString();
        document.getElementById('lifetimeSavings').textContent = '$' + lifetimeSavings.toLocaleString();

        // Update additional sections
        updateCoverageSummary(coverageType, deductible, reimbursementRate, addons);
        updateSavingsTips(petAge, deductible, addons);

        // Show results
        results.classList.remove('hidden');
        results.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }

    function displayEnhancedPetResults(rates, petInfo) {
      const enhancedHTML = `
        <div class="bg-gradient-to-br from-blue-50 to-green-50 dark:from-blue-900/20 dark:to-green-900/20 rounded-lg p-6">
          <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-6 text-center">Pet Insurance Quotes</h3>
          
          <div class="grid md:grid-cols-3 gap-4 mb-6">
            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm text-center">
              <div class="text-lg font-bold text-blue-600">Basic Plan</div>
              <div class="text-2xl font-bold text-gray-900 dark:text-white">$${rates.basic}/month</div>
              <div class="text-sm text-gray-600 dark:text-gray-400">Accident coverage</div>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm text-center border-2 border-green-500">
              <div class="text-lg font-bold text-green-600">Comprehensive</div>
              <div class="text-2xl font-bold text-gray-900 dark:text-white">$${rates.comprehensive}/month</div>
              <div class="text-sm text-gray-600 dark:text-gray-400">Accident + Illness</div>
              <div class="text-xs text-green-600 font-medium mt-1">Most Popular</div>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm text-center">
              <div class="text-lg font-bold text-purple-600">Premium</div>
              <div class="text-2xl font-bold text-gray-900 dark:text-white">$${rates.premium}/month</div>
              <div class="text-sm text-gray-600 dark:text-gray-400">Full coverage + Wellness</div>
            </div>
          </div>

          <div class="grid md:grid-cols-2 gap-4 mb-4">
            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm">
              <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Your Pet Details</h4>
              <div class="text-sm space-y-1">
                <div><span class="text-gray-600 dark:text-gray-400">Pet Type:</span> <span class="capitalize">${petInfo.petType}</span></div>
                <div><span class="text-gray-600 dark:text-gray-400">Age Category:</span> <span class="capitalize">${petInfo.petAge}</span></div>
                <div><span class="text-gray-600 dark:text-gray-400">Size/Breed:</span> <span class="capitalize">${petInfo.breedCategory}</span></div>
                <div><span class="text-gray-600 dark:text-gray-400">Deductible:</span> $${petInfo.deductible}</div>
                <div><span class="text-gray-600 dark:text-gray-400">Reimbursement:</span> ${petInfo.reimbursementRate}%</div>
              </div>
            </div>
            
            <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm">
              <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Potential Savings</h4>
              <div class="text-sm space-y-1">
                <div>Annual Cost: <span class="font-medium">$${rates.comprehensive * 12}</span></div>
                <div>Lifetime Premiums: <span class="font-medium">$${(rates.comprehensive * 12 * (petInfo.petType === 'dog' ? 12 : 15)).toLocaleString()}</span></div>
                <div>Potential Vet Bills: <span class="font-medium text-green-600">$${(petInfo.petType === 'dog' ? 25000 : 18000).toLocaleString()}</span></div>
                <div class="pt-2 border-t">
                  <span class="text-green-600 font-bold">Potential Savings: $${Math.max(0, (petInfo.petType === 'dog' ? 25000 : 18000) - (rates.comprehensive * 12 * (petInfo.petType === 'dog' ? 12 : 15))).toLocaleString()}</span>
                </div>
              </div>
            </div>
          </div>

          <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4">
            <h4 class="font-semibold text-yellow-800 dark:text-yellow-300 mb-2">Important Information</h4>
            <div class="text-sm text-yellow-700 dark:text-yellow-400 space-y-1">
              <p>• Rates shown are estimates based on average market data for your pet's profile</p>
              <p>• Actual premiums vary by insurance company, location, and your pet's health history</p>
              <p>• Pre-existing conditions are typically not covered</p>
              <p>• Consider enrolling while your pet is young and healthy for the best rates</p>
              <p>• Compare multiple providers to find the best coverage and value</p>
            </div>
          </div>
        </div>
      `;
      
      results.innerHTML = enhancedHTML;
      results.classList.remove('hidden');
      results.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function calculateLifetimeSavings(petType, coverageType, monthlyPremium) {
      const averageLifespan = petType === 'dog' ? 12 : 15;
      const totalPremiums = monthlyPremium * 12 * averageLifespan;
      
      let potentialVetCosts = 0;
      if (coverageType === 'comprehensive') {
        potentialVetCosts = petType === 'dog' ? 25000 : 18000;
      } else {
        potentialVetCosts = petType === 'dog' ? 12000 : 8000;
      }
      
      return Math.max(0, potentialVetCosts - totalPremiums);
    }

    function updateCoverageSummary(coverageType, deductible, reimbursementRate, addons) {
      const summary = document.getElementById('coverageSummary');
      let html = '';

      if (coverageType === 'comprehensive') {
        html += '<div>✅ Accidents and injuries covered</div>';
        html += '<div>✅ Illnesses and chronic conditions covered</div>';
        html += '<div>✅ Diagnostic tests and treatments covered</div>';
        html += '<div>✅ Prescription medications covered</div>';
      } else {
        html += '<div>✅ Accidents and injuries covered</div>';
        html += '<div>❌ Illnesses not covered (accident-only plan)</div>';
      }

      html += `<div>💰 $${deductible} annual deductible</div>`;
      html += `<div>📊 ${reimbursementRate}% reimbursement rate</div>`;

      if (addons.length > 0) {
        html += '<div class="mt-2 pt-2 border-t border-gray-200 dark:border-gray-600">';
        html += '<div class="font-medium">Add-on Coverage:</div>';
        if (addons.includes('wellness')) html += '<div>✅ Wellness & routine care</div>';
        if (addons.includes('dental')) html += '<div>✅ Dental coverage</div>';
        if (addons.includes('alternative')) html += '<div>✅ Alternative therapies</div>';
        html += '</div>';
      }

      summary.innerHTML = html;
    }

    function updateSavingsTips(petAge, deductible, addons) {
      const tips = document.getElementById('savingsTips');
      let html = '';

      if (petAge === 'senior') {
        html += '<li>Consider enrolling younger pets early for better rates</li>';
      }

      if (deductible < 500) {
        html += '<li>Higher deductibles can reduce monthly premiums significantly</li>';
      }

      if (!addons.includes('wellness')) {
        html += '<li>Wellness coverage can save money on routine vet visits</li>';
      }

      html += '<li>Multi-pet discounts available with most insurers (5-10% savings)</li>';
      html += '<li>Annual payment discounts can save 5-15% vs monthly payments</li>';
      html += '<li>Some employers offer pet insurance as a voluntary benefit</li>';

      tips.innerHTML = html;
    }
  });
</script>